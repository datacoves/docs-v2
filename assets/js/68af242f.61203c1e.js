"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4538],{8335:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"how-tos/airflow/use-airflow-api","title":"How to use the Airflow API","description":"[!WARNING] Users must have Project Level Admin Group to use the Airflow API. The API will allow you to view secrets values in plain text. Always exercise the principle of least privilege.","source":"@site/docs/how-tos/airflow/use-airflow-api.md","sourceDirName":"how-tos/airflow","slug":"/how-tos/airflow/use-airflow-api","permalink":"/docusaurus-test/docs/how-tos/airflow/use-airflow-api","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/how-tos/airflow/use-airflow-api.md","tags":[],"version":"current","frontMatter":{},"sidebar":"howToSidebar","previous":{"title":"Airflow - Initial setup","permalink":"/docusaurus-test/docs/how-tos/airflow/initial-setup"},"next":{"title":"Airflow - Sync Internal Airflow database","permalink":"/docusaurus-test/docs/how-tos/airflow/sync-database"}}');var i=s(74848),r=s(28453);const o={},a="How to use the Airflow API",l={},d=[{value:"Step 1: Navigate to your target environment",id:"step-1-navigate-to-your-target-environment",level:3},{value:"Step 2: Copy the API URL",id:"step-2-copy-the-api-url",level:3},{value:"Step 3 the API KEY",id:"step-3-the-api-key",level:3},{value:"Step 4: Add your credentials to a .env file",id:"step-4-add-your-credentials-to-a-env-file",level:3},{value:"Step 5: Use it in a python script",id:"step-5-use-it-in-a-python-script",level:3}];function c(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"how-to-use-the-airflow-api",children:"How to use the Airflow API"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"[!WARNING] Users must have Project Level Admin Group to use the Airflow API. The API will allow you to view secrets values in plain text. Always exercise the principle of least privilege."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This how to will walk you through configuring the Airflow API and using it in a DAG."}),"\n",(0,i.jsx)(n.h3,{id:"step-1-navigate-to-your-target-environment",children:"Step 1: Navigate to your target environment"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A user with the appropriate access can navigate to the ",(0,i.jsx)(n.code,{children:"Environments"})," in the navigation menu."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Environments",src:s(75288).A+"",width:"488",height:"686"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Then Select the Pad lock icon for the Airflow environment you wish to access."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pad lock",src:s(99971).A+"",width:"2598",height:"1254"})}),"\n",(0,i.jsx)(n.h3,{id:"step-2-copy-the-api-url",children:"Step 2: Copy the API URL"}),"\n",(0,i.jsxs)(n.p,{children:["Copy the ",(0,i.jsx)(n.code,{children:"Airflow API URL"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"API URL",src:s(19873).A+"",width:"2598",height:"1254"})}),"\n",(0,i.jsxs)(n.h3,{id:"step-3-the-api-key",children:["Step 3",":Generate"," the API KEY"]}),"\n",(0,i.jsx)(n.p,{children:"Generate your API key and copy it somewhere secure. Once you click away it will not be shown again."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Generate API",src:s(49735).A+"",width:"2598",height:"1254"})}),"\n",(0,i.jsx)(n.h3,{id:"step-4-add-your-credentials-to-a-env-file",children:"Step 4: Add your credentials to a .env file"}),"\n",(0,i.jsxs)(n.p,{children:["Create a ",(0,i.jsx)(n.code,{children:".env"})," file inside your ",(0,i.jsx)(n.code,{children:"orchestrate/"})," directory and be sure to add the file to your ",(0,i.jsx)(n.code,{children:".gitignore"}),". Add your credentials there."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-env",children:'AIRFLOW_API_URL = "https://..."\nDATACOVES_API_KEY = "...."\n'})}),"\n",(0,i.jsx)(n.h3,{id:"step-5-use-it-in-a-python-script",children:"Step 5: Use it in a python script"}),"\n",(0,i.jsx)(n.p,{children:"Below is a sample script that makes use of the Airflow API."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"This script does the following:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Initializes the Airflow API client using authentication details from environment variables."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Fetches a list of all DAGs from the Airflow API."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Prints a sorted list of DAG IDs for better readability."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Triggers a new DAG run for a specified DAG using the API."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Updates an Airflow dataset using the API."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Handles API errors and retries requests if necessary."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# airflow_api_call.py\nimport requests\nimport os\nimport json\nfrom dotenv import load_dotenv\n\nload_dotenv()\nAPI_URL =  os.getenv("AIRFLOW_API_URL")\nAPI_KEY =  os.getenv("DATACOVES_API_KEY")\n\ndef update_dataset(name):\n    url=f"{API_URL}/datasets/events"\n\n    response = requests.post(\n        url=url,\n        headers = {\n            "Authorization": f"Token {API_KEY}",\n        },\n        json={"dataset_uri": "upstream_data",}\n    )\n    return response.json()\n\n\ndef trigger_dag(dag_id):\n    url=f"{API_URL}/dags/{dag_id}/dagRuns"\n\n    response = requests.post(\n        url=url,\n        headers = {\n            "Authorization": f"Token {API_KEY}",\n        },\n        json={"note": "Trigger from API",}\n    )\n    return response.json()\n\n\ndef list_dags():\n    url=f"{API_URL}/dags"\n\n    response = requests.get(\n        url=url,\n        headers = {\n            "Authorization": f"Token {API_KEY}",\n             "Content-Type": "application/json",\n        },\n    )\n\n    # Extract just the DAG names from the response\n    dags_data = response.json()\n    dag_names = [dag[\'dag_id\'] for dag in dags_data[\'dags\']]\n\n    # Sort the names alphabetically for better readability\n    dag_names.sort()\n    return dag_names\n\n\ndef print_response(response):\n    if response:\n        msg = json.dumps(response, indent=2)\n        print(f"Event posted successfully:\\n{\'=\'*30}\\n\\n {msg}")\n\n\nif __name__ == "__main__":\n\n    # Update an Airflow Dataset\n    # dataset_name = "upstream_data"\n    # response = update_dataset(dataset_name)\n    # print_response(response)\n\n    # Trigger a DAG\n    # dag_id = "bad_variable_usage"\n    # response = trigger_dag(dag_id)\n    # print_response(response)\n\n    # List DAGs\n    response = list_dags()\n    print_response(response)\n'})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},19873:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/environment_api_url-b0355288acf62eac76ae69e1ad223912.jpg"},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(96540);const i={},r=t.createContext(i);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:n},e.children)}},49735:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/environment_api_key-16d9f1212b6d7bd7c2752ae410ef15db.jpg"},75288:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/menu_environments-28ad67b99ef2db7956f89f8ba1c9825d.gif"},99971:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/environments_api_edit-5c8e9059dfc48f98af6995deb6d56b66.jpg"}}]);