"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7751],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}},28794:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/add_smtp_integration-964df776152e3b88203d9155f42f5929.png"},42271:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/environment_edit_icon-8c3f9bbf185e64a11edf916b5fe7f66d.jpg"},50087:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/menu_integrations-1e5dd1c2c142c4a45bf94a4d531f2b75.gif"},50731:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/edit_integrations-d44c1c7c6ca382837c9f874f37c6dbc8.png"},67064:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/menu_environments-28ad67b99ef2db7956f89f8ba1c9825d.gif"},89991:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"how-tos/airflow/send-emails","title":"Send emails","description":"Getting notifications when there is a failure is critical for data teams and Airflow allows multiple ways to keep users informed about the status of a DAG.","source":"@site/docs/how-tos/airflow/send-emails.md","sourceDirName":"how-tos/airflow","slug":"/how-tos/airflow/send-emails","permalink":"/docusaurus-test/docs/how-tos/airflow/send-emails","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/how-tos/airflow/send-emails.md","tags":[],"version":"current","sidebarPosition":19,"frontMatter":{"title":"Send emails","sidebar_position":19},"sidebar":"tutorialSidebar","previous":{"title":"S3 to snowflake","permalink":"/docusaurus-test/docs/how-tos/airflow/s3-to-snowflake"},"next":{"title":"Send ms teams notifications","permalink":"/docusaurus-test/docs/how-tos/airflow/send-ms-teams-notifications"}}');var s=t(74848),o=t(28453);const r={title:"Send emails",sidebar_position:19},a="How to send email notifications on DAG's failure",d={},l=[{value:"Configure SMTP integration in Environment",id:"configure-smtp-integration-in-environment",level:2},{value:"Set up a custom SMTP (Optional)",id:"set-up-a-custom-smtp-optional",level:2},{value:"Add integration to an Environment",id:"add-integration-to-an-environment",level:2},{value:"Implement in a DAG",id:"implement-in-a-dag",level:2},{value:"Python version",id:"python-version",level:3},{value:"YAML version",id:"yaml-version",level:3},{value:"DRY default_args",id:"dry-default_args",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"how-to-send-email-notifications-on-dags-failure",children:"How to send email notifications on DAG's failure"})}),"\n",(0,s.jsx)(n.p,{children:"Getting notifications when there is a failure is critical for data teams and Airflow allows multiple ways to keep users informed about the status of a DAG."}),"\n",(0,s.jsx)(n.p,{children:"This page will show you how to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use the Datacoves default SMTP"}),"\n",(0,s.jsx)(n.li,{children:"Add the integration to your environment"}),"\n",(0,s.jsx)(n.li,{children:"Create a custom smtp Integration for Airflow (optional)"}),"\n",(0,s.jsx)(n.li,{children:"Create a DAG that makes use of the notification integration"}),"\n",(0,s.jsx)(n.li,{children:"Bonus: DRY default_args"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"After completing these steps you will be able to receive email notifications upon DAG failure."}),"\n",(0,s.jsx)(n.p,{children:"Let's get started!"}),"\n",(0,s.jsx)(n.h2,{id:"configure-smtp-integration-in-environment",children:"Configure SMTP integration in Environment"}),"\n",(0,s.jsxs)(n.p,{children:["Datacoves provides a ",(0,s.jsx)(n.strong,{children:"pre-configured SMTP"})," connection which will send out a failure email from ",(0,s.jsx)(n.code,{children:"hey@datacoves.com"})," to email recipients you configure in your DAGs."]}),"\n",(0,s.jsxs)(n.p,{children:["In Datacoves 3.3 and up, the ",(0,s.jsx)(n.code,{children:"SMTP"})," will be automatically added to your environment upon creation. If you created your environment before Datacoves 3.3 follow these instructions to configure the default SMTP."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["First, go to the ",(0,s.jsx)(n.code,{children:"Environments"})," admin."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Environments admin",src:t(67064).A+"",width:"488",height:"686"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click the Edit icon for the environment containing the Airflow service you want to configure, then navigate to the ",(0,s.jsx)(n.code,{children:"Integrations"})," tab."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Edit Icon",src:t(42271).A+"",width:"2497",height:"851"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click on the ",(0,s.jsx)(n.code,{children:"+ Add new integration"})," button."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Edit integrations",src:t(50731).A+"",width:"2434",height:"916"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.code,{children:"SMTP"}),". In the second dropdown select ",(0,s.jsx)(n.code,{children:"Airflow"})," as service."]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Save Changes"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Viola!\ud83c\udf89 The Airflow service will be restarted shortly and will now include the SMTP configuration required to send emails."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["[!NOTE] ",(0,s.jsx)(n.strong,{children:"Getting Started Guide:"})," If you are making your way through our ",(0,s.jsx)(n.a,{href:"/getting-started/Admin/",children:"getting started guide"}),", please continue on to ",(0,s.jsx)(n.a,{href:"/docusaurus-test/docs/getting-started/Admin/creating-airflow-dags",children:"developing DAGs"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"set-up-a-custom-smtp-optional",children:"Set up a custom SMTP (Optional)"}),"\n",(0,s.jsxs)(n.p,{children:["If you do not wish to use the default SMTP server, you can configure your own.\nFirst, create a new integration of type ",(0,s.jsx)(n.code,{children:"SMTP"})," by navigating to the Integrations Admin."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Integrations Admin",src:t(50087).A+"",width:"488",height:"686"})}),"\n",(0,s.jsxs)(n.p,{children:["Click on the ",(0,s.jsx)(n.code,{children:"+ New integration"})," button. ",(0,s.jsx)(n.strong,{children:"Fill out the fields as seen below:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Name:"})," Provide a descriptive name such as ",(0,s.jsx)(n.code,{children:"Mail Service "})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," Select ",(0,s.jsx)(n.code,{children:"SMTP"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Host:"})," Enter the smtp server for your domain."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Port:"})," TLS encryption on port 587. If you\u2019d like to implement SSL encryption, use port 465."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"From Address:"})," This is the address that you have configured for smtp"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"User:"})," Same address as the ",(0,s.jsx)(n.code,{children:"From Address"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Password:"})," Password that you have configured for smtp"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Save Integration",src:t(96132).A+"",width:"2154",height:"1512"})}),"\n",(0,s.jsxs)(n.p,{children:["Click ",(0,s.jsx)(n.code,{children:"Save Changes"})]}),"\n",(0,s.jsx)(n.h2,{id:"add-integration-to-an-environment",children:"Add integration to an Environment"}),"\n",(0,s.jsxs)(n.p,{children:["Once you created the ",(0,s.jsx)(n.code,{children:"SMTP"})," integration, it's time to add it to the Airflow service in an environment."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["First, go to the ",(0,s.jsx)(n.code,{children:"Environments"})," admin."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Environments admin",src:t(67064).A+"",width:"488",height:"686"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Select the Edit icon for the environment that has the Airflow service you want to configure, and then click on the ",(0,s.jsx)(n.code,{children:"Integrations"})," tab."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Edit integrations",src:t(50731).A+"",width:"2434",height:"916"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click on the ",(0,s.jsx)(n.code,{children:"+ Add new integration"})," button, and then, select the integration you created previously."]}),"\n",(0,s.jsxs)(n.li,{children:["In the second dropdown select ",(0,s.jsx)(n.code,{children:"Airflow"})," as service."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Add integration",src:t(28794).A+"",width:"2052",height:"826"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Save Changes"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"implement-in-a-dag",children:"Implement in a DAG"}),"\n",(0,s.jsx)(n.p,{children:"If you have already created a DAG it's time to modify your DAG to make use of our newly set up SMTP integration on Airflow."}),"\n",(0,s.jsxs)(n.p,{children:["Simply provide a ",(0,s.jsx)(n.code,{children:"default_args"})," dict like so:"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["[!TIP]You can add as many email recipients needed by passing a list into the email field. eg) ",(0,s.jsx)(n.code,{children:'email: ["gomezn@example.com", "mayra@example.com", "walter@example.com"]'})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"python-version",children:"Python version"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from pendulum import datetime\nfrom airflow.decorators import dag, task\n\n@dag(\n    default_args={\n        "start_date": datetime(2024, 1, 1),\n        "owner": "Noel Gomez",  # Replace with your name\n        "email": ["gomezn@example.com", "mayra@example.com", "walter@example.com"], \n        "email_on_failure": True,\n        "email_on_retry": False,\n    },\n    description="Sample DAG for dbt build",\n    schedule="0 0 1 */12 *",\n    tags=["version_1"],\n    catchup=False,\n)\ndef dbt_run():\n\n    @task.datacoves_dbt(connection_id="main")  \n    def build_dbt():\n        return "dbt run -s personal_loans"\n\n    build_dbt()  \n\ndag = dbt_run()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"yaml-version",children:"YAML version"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'description: "Sample DAG for dbt run"\nschedule: "0 0 1 */12 *"\ntags:\n  - version_1\ndefault_args:\n  start_date: 2024-01-01\n  owner: Noel Gomez\n  # Replace with the email of the recipient for failures\n  email: \n    - gomezn@example.com\n    - mayra@example.com \n    - walter@example.com\n  email_on_failure: true\n  email_on_retry: false\n  catchup: false\n\nnodes:\n  build_dbt:\n    type: task\n    operator: operators.datacoves.dbt.DatacovesDbtOperator\n    bash_command: "dbt run -s personal_loans" # Replace the name of the model\n'})}),"\n",(0,s.jsx)(n.h2,{id:"dry-default_args",children:"DRY default_args"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"[!TIP] We recommend placing your default_args in its own file and importing it for reusability. In the example below we created a file inside of orchestrate/utils/"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# orchestrate/utils/default_args.py\nfrom datetime import datetime, timedelta\n\ndefault_args = {\n    'owner': 'mayra@example.com',\n    'email_on_failure': False,\n    'email_on_retry': False,\n    'retries': 3,\n    'retry_delay': timedelta(minutes=5),\n    'start_date': datetime(2024, 1, 1),\n}\n\n\nfrom airflow.decorators import dag, task\nfrom orchestrate.utils.default_args import default_args  # Import default args\n\n@dag(\n    default_args=default_args,  # Use imported default args\n    description=\"Daily dbt run\",\n    schedule=\"0 12 * * *\",\n    tags=[\"version_1\"],\n    catchup=False,\n)\ndef default_args_dag():\n\n    @task.datacoves_dbt(connection_id=\"main\")  \n    def run_dbt():\n        return \"dbt run -s country_codes\"\n\n    run_dbt()  \n\ndag = default_args_dag()\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},96132:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/save_smtp_integration-83c63cc5df0cb6b8d98a319f2db3ea0a.png"}}]);